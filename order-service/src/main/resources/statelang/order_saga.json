{
  "Name": "order_saga",
  "Comment": "Order creation Saga flow",
  "Version": "1.2",
  "Type": "STATE_LANG",
  "StartState": "deductInventory",
  "States": {
    "deductInventory": {
      "Type": "ServiceTask",
      "ServiceName": "inventoryService",
      "ServiceMethod": "deduct",
      "Input": [
        {
          "Type": "java.util.Map",
          "Name": "context",
          "Expression": "#root"
        }
      ],
      "CompensateState": "revertInventory",
      "Next": "makePayment",
      "Retries": 1,
      "Timeout": 60000
    },
    "makePayment": {
      "Type": "ServiceTask",
      "ServiceName": "paymentService",
      "ServiceMethod": "deduct",
      "Input": [
        {
          "Type": "java.util.Map",
          "Name": "context",
          "Expression": "#root"
        }
      ],
      "CompensateState": "refundPayment",
      "End": true,
      "Retries": 1,
      "Timeout": 60000
    },
    "revertInventory": {
      "Type": "ServiceTask",
      "ServiceName": "inventoryService",
      "ServiceMethod": "compensate",
      "Input": [
        {
          "Type": "java.util.Map",
          "Name": "context",
          "Expression": "#root"
        }
      ],
      "Retries": 1,
      "Timeout": 60000
    },
    "refundPayment": {
      "Type": "ServiceTask",
      "ServiceName": "paymentService",
      "ServiceMethod": "compensate",
      "Input": [
        {
          "Type": "java.util.Map",
          "Name": "context",
          "Expression": "#root"
        }
      ],
      "Retries": 1,
      "Timeout": 60000
    }
  }
}
